file scripts/geospatial/geography.sql;

-- Tests for valid polygons
-- parsing is case-insensitive
exec make_polygon 1 'polygon((32.305 -64.751, 25.244 -80.437, 18.476 -66.371, 32.305 -64.751))';
exec make_polygon 2 'PoLyGoN((32.305 -64.751, 25.244 -80.437, 18.476 -66.371, 32.305 -64.751))';

-- parsing is whitespace-insensitive
exec make_polygon 3 '  POLYGON  (  (  32.305  -64.751  ,  25.244  -80.437  ,  18.476  -66.371  ,  32.305   -64.751  )  ) ';

-- insert polygon with a hole
exec make_polygon 4 '  POLYGON((32.305 -64.751, 25.244 -80.437, 18.476 -66.371, 32.305 -64.751), (28.066 -68.874, 25.361 -68.855, 28.376 -73.381, 28.066 -68.874))';

-- Test for invalid polygons - polygons not created appropriately
-- polygon with syntax errors
exec make_polygon 100 'NOT_A_POLYGON(...)';
exec make_polygon 101 'POLYGON(3 3, 4 4, 5 5, 3 3)';
exec make_polygon 102 'POLYGON ((80 80, 60, 70 70, 90 90))';
exec make_polygon 103 'POLYGON ((80 80 60 60, 70 70, 90 90))';
exec make_polygon 104 'POLYGON ((80 80, 60 60, 70 70,';
exec make_polygon 105 'POLYGON ((80 80, 60 60, 70 70, (30 15, 15 30, 15 45))';

-- missing rings or rings not formed with atleast 4 points
exec make_polygon 106 'POLYGON ()';
exec make_polygon 107 'POLYGON ((10 10, 20 20, 30 30))';

-- Test for valid,null polygon
exec make_polygon 200 null;

select * from polygons;

drop procedure make_polygon;

drop table polygons;